<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>×”×¢×•×–×¨ ×”××™×©×™ ×œ×”×–×× ×•×ª - ×—.×¡×‘×Ÿ</title>
    <!-- All other meta tags, links and styles remain the same -->
    <style>
        /* All existing styles from your previous file are here */
        #error-toast {
            position: fixed;
            top: -150px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #d32f2f;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            z-index: 10000;
            transition: top 0.5s cubic-bezier(0.17, 0.84, 0.44, 1);
            font-weight: 600;
            max-width: 90%;
            text-align: center;
            font-family: Assistant, sans-serif;
        }
    </style>
</head>
<body>
    <!-- Existing HTML Structure -->
    <div id="app-container">
        <!-- App content will be dynamically generated here -->
    </div>
    <div id="error-toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CRITICAL UPDATE: NEW API URL ---
            const API_URL = 'https://script.google.com/macros/s/AKfycbyrmRVp5NtEDjuidvAOfC8tUjPzQVI2ukBqJsKY6hb4X8c24G48SimYEJuGLiL5yUc/exec';
            
            // All other state variables and functions (showToast, apiPost, init, etc.) remain here
            // ...

            /**
             * The new, robust function for all API communications.
             */
            async function apiPost(body) {
                console.log('%cğŸš€ Sending API Request:', 'color: #0b72b9; font-weight: bold;', body);
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        redirect: 'follow',
                        body: JSON.stringify(body),
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`×©×’×™××ª ×©×¨×ª (HTTP ${response.status})`);
                    }

                    const data = await response.json();
                    console.log('%câœ… Received API Response:', 'color: #2e7d32; font-weight: bold;', data);
                    
                    if (data.success === false) {
                         throw new Error(data.message || '×”×©×¨×ª ×”×—×–×™×¨ ×©×’×™××” ×œ× ×¦×¤×•×™×”.');
                    }

                    return data;

                } catch (error) {
                    console.error('%câŒ API Communication Failure:', 'color: #d32f2f; font-weight: bold;', error);
                    
                    let userMessage;
                    if (error.message.includes('Failed to fetch')) {
                        userMessage = '×›×©×œ ×‘×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª. ×× × ×‘×“×•×§ ××ª ×—×™×‘×•×¨ ×”×¨×©×ª ×•×•×“× ×©×”×¤×¨×™×¡×” ×©×œ ×”×¡×§×¨×™×¤×˜ ×ª×§×™× ×”.';
                    } else {
                        userMessage = error.message;
                    }
                    
                    // The showToast function you have will display this error
                    // showToast(userMessage); 
                    throw new Error(userMessage);
                }
            }

            // --- The rest of your JavaScript code follows ---
            // init();
        });
    </script>
</body>
</html>

